<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Mauricio Vargas" />

<meta name="date" content="2019-12-02" />

<title>Uso básico del paquete casen</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Uso básico del paquete casen</h1>
<h4 class="author">Mauricio Vargas</h4>
<h4 class="date">2019-12-02</h4>



<div id="descargar-datos" class="section level1">
<h1>Descargar datos</h1>
<p>Para descargar la encuesta CASEN hay varias opciones:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(casen)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># todos los anios disponibles</span>
<span class="kw">descargar_casen</span>()

<span class="co"># solo anio 2017</span>
<span class="kw">descargar_casen</span>(<span class="dv">2017</span>)

<span class="co"># todos los anios disponibles en carpeta descargas</span>
<span class="kw">descargar_casen</span>(<span class="st">&quot;descargas&quot;</span>)

<span class="co"># solo anio 2017 en carpeta descargas</span>
<span class="kw">descargar_casen</span>(<span class="dv">2017</span>, <span class="st">&quot;descargas&quot;</span>)

<span class="co"># leer encuesta CASEN en formato SAV (SPSS)</span>
<span class="co"># (se debe descomprimir con winRAR u otro)</span>
<span class="kw">library</span>(haven)
<span class="kw">read_sav</span>(<span class="st">&quot;descargas/2017.sav&quot;</span>)</code></pre></div>
</div>
<div id="disenos-complejos" class="section level1">
<h1>Diseños complejos</h1>
<p>El valor agregado del paquete CASEN es que entrega una forma fácil de hacer cálculos tomando en cuenta, además del diseño complejo, los grados de libertad.</p>
<p>En el contexto de muestreo bietápico, el cálculo de los grados de libertad es un tema no resuelto, pero el paquete casen utiliza la siguiente definición del INE: “Los grados de libertad corresponden a la diferencia entre el número de conglomerados no vacíos (con presencia de la variable de interés) y el número de estratos no vacíos”.</p>
<p>En dominios de estimación pequeños la pérdida de grados de libertad se vuelve bastante relevante. Esto es muy importante cuando se hacen cálculos agrupando por región, sexo, región y sexo, entre otras.</p>
<p>Al usar la función <code>svyby</code> del paquete survey, la función no calcula correctamente los grados de libertad de cada dominio, sino que considera un valor fijo para todos los dominios. Las funciones del paquete casen usan esta función pero incluyen una serie de pasos programados para usar los grados de libertad adecuados para cada dominio de estimación.</p>
<p>Vamos a leer un subconjunto de la encuesta CASEN que corresponde a las comunas con representatividad comunal en la Región de los Ríos. Estos datos se incluyen, a modo de demostración, con el paquete casen.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">casen_<span class="dv">2017</span>_los_rios</code></pre></div>
<pre><code>## # A tibble: 8,055 x 7
##     expc varstrat   varunit ytotcorh      sexo        comuna        pobreza
##    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl+lbl&gt;     &lt;dbl+lbl&gt;      &lt;dbl+lbl&gt;
##  1    53   141283   1.41e10   959765 2 [Mujer] 14101 [Valdi… 3 [No pobres] 
##  2    53   141283   1.41e10   959765 2 [Mujer] 14101 [Valdi… 3 [No pobres] 
##  3    53   141283   1.41e10   959765 2 [Mujer] 14101 [Valdi… 3 [No pobres] 
##  4   105   141283   1.41e10   283273 2 [Mujer] 14101 [Valdi… 2 [Pobres no …
##  5   105   141283   1.41e10   283273 1 [Hombr… 14101 [Valdi… 2 [Pobres no …
##  6   105   141283   1.41e10   283273 2 [Mujer] 14101 [Valdi… 2 [Pobres no …
##  7   105   141283   1.41e10   353083 2 [Mujer] 14101 [Valdi… 3 [No pobres] 
##  8   105   141283   1.41e10   260000 2 [Mujer] 14101 [Valdi… 2 [Pobres no …
##  9   105   141283   1.41e10   260000 2 [Mujer] 14101 [Valdi… 2 [Pobres no …
## 10   105   141283   1.41e10   260000 1 [Hombr… 14101 [Valdi… 2 [Pobres no …
## # … with 8,045 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># disenio complejo a partir de  los datos de ejemplo</span>
cd &lt;-<span class="st"> </span><span class="kw">configuracion_disenio</span>(casen_<span class="dv">2017</span>_los_rios, <span class="st">&quot;ytotcorh&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;comuna&quot;</span>, <span class="st">&quot;sexo&quot;</span>), <span class="st">&quot;expc&quot;</span>)
cd<span class="op">$</span>disenio</code></pre></div>
<pre><code>## Stratified 1 - level Cluster Sampling design (with replacement)
## With (67) clusters.
## Called via srvyr
## Sampling variables:
##  - ids: varunit
##  - strata: varstrat
##  - weights: expc
## Data variables: ytotcorh (dbl), comuna (dbl+lbl), sexo (dbl+lbl), expc
##   (dbl), varunit (dbl), varstrat (dbl)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cd<span class="op">$</span>grupos</code></pre></div>
<pre><code>## # A tibble: 12 x 2
##                 comuna       sexo
##              &lt;dbl+lbl&gt;  &lt;dbl+lbl&gt;
##  1 14101 [Valdivia]    2 [Mujer] 
##  2 14101 [Valdivia]    1 [Hombre]
##  3 14104 [Los Lagos]   1 [Hombre]
##  4 14104 [Los Lagos]   2 [Mujer] 
##  5 14107 [Paillaco]    1 [Hombre]
##  6 14107 [Paillaco]    2 [Mujer] 
##  7 14108 [Panguipulli] 2 [Mujer] 
##  8 14108 [Panguipulli] 1 [Hombre]
##  9 14201 [La Unión]    1 [Hombre]
## 10 14201 [La Unión]    2 [Mujer] 
## 11 14204 [Río Bueno]   1 [Hombre]
## 12 14204 [Río Bueno]   2 [Mujer]</code></pre>
</div>
<div id="medidas-de-tendencia-central-con-diseno-complejo" class="section level1">
<h1>Medidas de tendencia central con diseño complejo</h1>
<p>La función <code>estadistica_descriptiva()</code> toma en cuenta el diseño complejo y los grados de libertad. Puedo agrupar por una o más variables y la función entrega, además del promedio, el intervalo de confianza.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># media, mediana y percentil 70</span>
<span class="kw">media_agrupada</span>(cd)</code></pre></div>
<pre><code>## # A tibble: 12 x 7
##    comuna_etiqueta sexo_etiqueta comuna_codigo sexo_codigo media_ytotcorh
##    &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt;                &lt;dbl&gt;
##  1 Valdivia        Mujer         14101         2                 1262564.
##  2 Valdivia        Hombre        14101         1                 1347409.
##  3 Los Lagos       Hombre        14104         1                  718525.
##  4 Los Lagos       Mujer         14104         2                  730578.
##  5 Paillaco        Hombre        14107         1                  707612.
##  6 Paillaco        Mujer         14107         2                  689113.
##  7 Panguipulli     Mujer         14108         2                  631138.
##  8 Panguipulli     Hombre        14108         1                  684710.
##  9 La Unión        Hombre        14201         1                  804543.
## 10 La Unión        Mujer         14201         2                  751564.
## 11 Río Bueno       Hombre        14204         1                  772788.
## 12 Río Bueno       Mujer         14204         2                  713756.
## # … with 2 more variables: media_ytotcorh_inf &lt;dbl&gt;,
## #   media_ytotcorh_sup &lt;dbl&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mediana_agrupada</span>(cd)</code></pre></div>
<pre><code>## # A tibble: 12 x 7
##    comuna_etiqueta sexo_etiqueta comuna_codigo sexo_codigo mediana_ytotcorh
##    &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt;                  &lt;dbl&gt;
##  1 Valdivia        Mujer         14101         2                    900000 
##  2 Valdivia        Hombre        14101         1                    914376.
##  3 Los Lagos       Hombre        14104         1                    612354.
##  4 Los Lagos       Mujer         14104         2                    635936 
##  5 Paillaco        Hombre        14107         1                    553684 
##  6 Paillaco        Mujer         14107         2                    532639.
##  7 Panguipulli     Mujer         14108         2                    532261.
##  8 Panguipulli     Hombre        14108         1                    559715.
##  9 La Unión        Hombre        14201         1                    622461 
## 10 La Unión        Mujer         14201         2                    567739.
## 11 Río Bueno       Hombre        14204         1                    696373.
## 12 Río Bueno       Mujer         14204         2                    631806 
## # … with 2 more variables: mediana_ytotcorh_inf &lt;dbl&gt;,
## #   mediana_ytotcorh_sup &lt;dbl&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">percentiles_agrupados</span>(cd)</code></pre></div>
<pre><code>## # A tibble: 12 x 7
##    percentil comuna_etiqueta sexo_etiqueta comuna_codigo sexo_codigo
##        &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt;      
##  1       0.7 Valdivia        Mujer         14101         2          
##  2       0.7 Valdivia        Hombre        14101         1          
##  3       0.7 Los Lagos       Hombre        14104         1          
##  4       0.7 Los Lagos       Mujer         14104         2          
##  5       0.7 Paillaco        Hombre        14107         1          
##  6       0.7 Paillaco        Mujer         14107         2          
##  7       0.7 Panguipulli     Mujer         14108         2          
##  8       0.7 Panguipulli     Hombre        14108         1          
##  9       0.7 La Unión        Hombre        14201         1          
## 10       0.7 La Unión        Mujer         14201         2          
## 11       0.7 Río Bueno       Hombre        14204         1          
## 12       0.7 Río Bueno       Mujer         14204         2          
## # … with 2 more variables: mediana_ytotcorh &lt;dbl&gt;,
## #   mediana_ytotcorh_err_est &lt;dbl&gt;</code></pre>
</div>
<div id="uso-de-las-funciones-de-casen-y-dplyr" class="section level1">
<h1>Uso de las funciones de casen y dplyr</h1>
<p>Las funciones de <code>casen</code> están pensadas para usarse en conjunto con las de <code>dplyr</code>. Un ejemplo simple de esto es el cálculo del porcentaje de hogares pobres.</p>
<p>Veamos el caso puntual de las funciones <code>mutate</code> y <code>filter</code> de dplyr.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)</code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># convierto pobreza a una variable binaria</span>
casen_<span class="dv">2017</span>_los_rios <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pobreza =</span> <span class="kw">ifelse</span>(pobreza <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">configuracion_disenio</span>(<span class="st">&quot;pobreza&quot;</span>, <span class="st">&quot;comuna&quot;</span>, <span class="st">&quot;expc&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">media_agrupada</span>()</code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   comuna_etiqueta comuna_codigo media_pobreza media_pobreza_i…
##   &lt;chr&gt;           &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;
## 1 Valdivia        14101                0.0753           0.0513
## 2 Los Lagos       14104                0.156            0.104 
## 3 Paillaco        14107                0.209           -0.0754
## 4 Panguipulli     14108                0.133            0.0928
## 5 La Unión        14201                0.132            0.0656
## 6 Río Bueno       14204                0.170            0.0736
## # … with 1 more variable: media_pobreza_sup &lt;dbl&gt;</code></pre>
</div>
<div id="inferencia-con-disenos-complejos" class="section level1">
<h1>Inferencia con diseños complejos</h1>
<p>El paquete casen provee dos funciones para sacar el máximo partido a las funciones de R tomando en cuenta el diseño complejo y los grados de libertad.</p>
<p>Ajuste del modelo:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># modelo: ytotcorh = b0 + b1 comuna + b2 sexo + e</span>
mod &lt;-<span class="st"> </span><span class="kw">modelo_lineal_generalizado</span>(cd, <span class="st">&quot;ytotcorh ~ comuna + sexo&quot;</span>)
<span class="kw">summary</span>(mod)</code></pre></div>
<pre><code>## 
## Call:
## svyglm(formula = stats::as.formula(modelo), design = disenio$disenio)
## 
## Survey design:
## Called via srvyr
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 55655084.7 13884444.7   4.008 0.000192 ***
## comuna         -3860.7      977.4  -3.950 0.000232 ***
## sexo          -58713.5    23514.9  -2.497 0.015672 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for gaussian family taken to be 1.491064e+12)
## 
## Number of Fisher Scoring iterations: 2</code></pre>
</div>
<div id="uso-de-las-funciones-de-casen-con-paquetes-tidy" class="section level1">
<h1>Uso de las funciones de casen con paquetes “tidy”</h1>
<p>Además de dplyr, casen se integra perfectamente con los paquetes del <a href="https://www.tidyverse.org/">Tidyverse</a> y otros paquetes afines.</p>
<p>Por ejemplo, el paquete broom permite obtener una tabla con los intervalos de confianza para los betas estimados del modelo.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(broom)
<span class="kw">library</span>(survey)</code></pre></div>
<pre><code>## Loading required package: grid</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## Loading required package: survival</code></pre>
<pre><code>## 
## Attaching package: 'survey'</code></pre>
<pre><code>## The following object is masked from 'package:graphics':
## 
##     dotchart</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(janitor)</code></pre></div>
<pre><code>## 
## Attaching package: 'janitor'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     chisq.test, fisher.test</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># usamos ddf y degf del paquete survey para hacer el mismo calculo</span>
<span class="co"># que realiza Stata</span>
mod_conf &lt;-<span class="st"> </span><span class="kw">confint_tidy</span>(mod, <span class="dt">ddf =</span> <span class="kw">degf</span>(cd<span class="op">$</span>disenio))
mod_conf</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##    conf.low conf.high
##       &lt;dbl&gt;     &lt;dbl&gt;
## 1 27830036. 83480134.
## 2    -5820.    -1902.
## 3  -105838.   -11589.</code></pre>
<p>Lo anterior se puede ordenar y presentar los betas junto con los intervalos de confianza.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ordenamos la salida del modelo</span>
mod_betas &lt;-<span class="st"> </span><span class="kw">tidy</span>(mod)

<span class="co"># pegamos las columnas</span>
mod_betas &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(mod_betas, mod_conf)

<span class="co"># ordenamos los nombres de las columnas</span>
mod_betas &lt;-<span class="st"> </span><span class="kw">clean_names</span>(mod_betas)

mod_betas</code></pre></div>
<pre><code>## # A tibble: 3 x 7
##   term         estimate std_error statistic  p_value  conf_low conf_high
##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept) 55655085. 13884445.      4.01 0.000192 27830036. 83480134.
## 2 comuna         -3861.      977.     -3.95 0.000232    -5820.    -1902.
## 3 sexo          -58714.    23515.     -2.50 0.0157    -105838.   -11589.</code></pre>
</div>
<div id="comparabilidad-entre-encuestas" class="section level1">
<h1>Comparabilidad entre encuestas</h1>
<p>El paquete casen provee un conjunto de datos (codigos_casen) con la correspondencia de los códigos de comunas.</p>
<p>Dejando de lado la representatividad comunal, veamos como convertir los códigos de la encuesta CASEN 1990 a códigos SUBDERE 2017.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">codigos_casen <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(valido_desde <span class="op">==</span><span class="st"> </span><span class="dv">1990</span>)</code></pre></div>
<pre><code>## # A tibble: 323 x 4
## # Groups:   codigo_casen, codigo_subdere_2017 [323]
##    valido_desde valido_hasta codigo_casen codigo_subdere_2017
##           &lt;dbl&gt;        &lt;dbl&gt;        &lt;int&gt; &lt;chr&gt;              
##  1         1990         2017        11201 11201              
##  2         1990         2003         5605 05602              
##  3         1990         2003        13504 13502              
##  4         1990         2003         3304 03302              
##  5         1990         2003         1307 01107              
##  6         1990         2003        10402 10202              
##  7         1990         2003         4104 04103              
##  8         1990         2003         9101 09201              
##  9         1990         2003         2301 02101              
## 10         1990         2003         8204 08302              
## # … with 313 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">casen1990 &lt;-<span class="st"> </span><span class="kw">read_sav</span>(<span class="st">&quot;descargas/1990.sav&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">comu =</span> <span class="kw">as.integer</span>(comu)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(
    codigos_casen <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(valido_desde <span class="op">==</span><span class="st"> </span><span class="dv">1990</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;codigo&quot;</span>)),
    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;comu&quot;</span> =<span class="st"> &quot;codigo_casen&quot;</span>)
  )</code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
