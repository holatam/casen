<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Mauricio Vargas" />

<meta name="date" content="2019-11-22" />

<title>Uso básico del paquete casen</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Uso básico del paquete casen</h1>
<h4 class="author">Mauricio Vargas</h4>
<h4 class="date">2019-11-22</h4>



<div id="leer-datos" class="section level1">
<h1>Leer datos</h1>
<p>Con el paquete <code>casen</code> podemos leer la encuesta en formato rar o zip. También es posible leer directamente en formato sav (SPSS) o dta (Stata).</p>
<p>Vamos a leer un subconjunto de los datos proporcionado por este paquete:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(casen)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">r14 &lt;-<span class="st"> </span><span class="kw">leer_casen</span>(<span class="kw">system.file</span>(<span class="dt">package =</span> <span class="st">&quot;casen&quot;</span>, <span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;casen_2017_los_rios.zip&quot;</span>))</a></code></pre></div>
<pre><code>## Intentando leer el archivo /home/pacha/github/casen/inst/extdata/casen_2017_los_rios.zip...</code></pre>
<pre><code>## Los metadatos de /home/pacha/github/casen/inst/extdata/casen_2017_los_rios.zip indican que el formato comprimido es adecuado, intentando leer...</code></pre>
<pre><code>## Resizing buffer to 32768.
## Resizing buffer to 65536.
## Resizing buffer to 131072.
## Resizing buffer to 262144.</code></pre>
<pre><code>## /home/pacha/github/casen/inst/extdata/casen_2017_los_rios.zip se pudo leer como tibble :-)</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">r14</a></code></pre></div>
<pre><code>## # A tibble: 10,172 x 7
##     expc varstrat   varunit ytotcorh      sexo        comuna        pobreza
##    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl+lbl&gt;     &lt;dbl+lbl&gt;      &lt;dbl+lbl&gt;
##  1    53   141283   1.41e10   959765 2 [Mujer] 14101 [Valdi… 3 [No pobres] 
##  2    53   141283   1.41e10   959765 2 [Mujer] 14101 [Valdi… 3 [No pobres] 
##  3    53   141283   1.41e10   959765 2 [Mujer] 14101 [Valdi… 3 [No pobres] 
##  4   105   141283   1.41e10   283273 2 [Mujer] 14101 [Valdi… 2 [Pobres no …
##  5   105   141283   1.41e10   283273 1 [Hombr… 14101 [Valdi… 2 [Pobres no …
##  6   105   141283   1.41e10   283273 2 [Mujer] 14101 [Valdi… 2 [Pobres no …
##  7   105   141283   1.41e10   353083 2 [Mujer] 14101 [Valdi… 3 [No pobres] 
##  8   105   141283   1.41e10   260000 2 [Mujer] 14101 [Valdi… 2 [Pobres no …
##  9   105   141283   1.41e10   260000 2 [Mujer] 14101 [Valdi… 2 [Pobres no …
## 10   105   141283   1.41e10   260000 1 [Hombr… 14101 [Valdi… 2 [Pobres no …
## # … with 10,162 more rows</code></pre>
<p>Para descargar la encuesta CASEN hay varias opciones:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># todos los anios disponibles</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">descargar_casen</span>()</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co"># solo anio 2017</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="kw">descargar_casen</span>(<span class="dv">2017</span>)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co"># todos los anios disponibles en carpeta descargas</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="kw">descargar_casen</span>(<span class="st">&quot;descargas&quot;</span>)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co"># solo anio 2017 en carpeta descargas</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="kw">descargar_casen</span>(<span class="dv">2017</span>, <span class="st">&quot;descargas&quot;</span>)</a></code></pre></div>
</div>
<div id="medidas-de-tendencia-central-con-diseño-complejo" class="section level1">
<h1>Medidas de tendencia central con diseño complejo</h1>
<p>La función <code>media_agrupada()</code> toma en cuenta el diseño complejo y los grados de libertad. Puedo agrupar por una o más variables y la función entrega, además del promedio, el intervalo de confianza.</p>
<p><em>Importante:</em> El conjunto de datos <code>r14</code> se incluye con este software para efectos de mostrar el uso de las funciones, la encuesta CASEN <em>no</em> asegura representatividad a nivel comunal.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># Media salarial por comuna</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">media_agrupada</span>(r14, <span class="st">&quot;ytotcorh&quot;</span>, <span class="st">&quot;comuna&quot;</span>, <span class="st">&quot;expc&quot;</span>)</a></code></pre></div>
<pre><code>## Warning in check_nas(estimate): Con la agregacion proporcionada algunas observaciones tienen cero
##     grados de libertad, por lo que no se puede estimar la varianza, dando como
##     resultado algunos elementos no finitos.</code></pre>
<pre><code>## # A tibble: 12 x 5
##    comuna_etiqueta comuna_codigo media_ytotcorh media_ytotcorh_…
##    &lt;chr&gt;           &lt;chr&gt;                  &lt;dbl&gt;            &lt;dbl&gt;
##  1 Valdivia        14101               1302074.         1051549.
##  2 Corral          14102                661004.           54555.
##  3 Lanco           14103                681373.          476772.
##  4 Los Lagos       14104                724512.          651247.
##  5 Máfil           14105                837918.             NaN 
##  6 Mariquina       14106                769778.          472702.
##  7 Paillaco        14107                698107.          459480.
##  8 Panguipulli     14108                655945.          592786.
##  9 La Unión        14201                777078.          686763.
## 10 Futrono         14202                770949.           28428.
## 11 Lago Ranco      14203                715104.             NaN 
## 12 Río Bueno       14204                741533.          633746.
## # … with 1 more variable: media_ytotcorh_sup &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># Media salarial por comuna y sexo</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">media_agrupada</span>(r14, <span class="st">&quot;ytotcorh&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;comuna&quot;</span>,<span class="st">&quot;sexo&quot;</span>), <span class="st">&quot;expc&quot;</span>)</a></code></pre></div>
<pre><code>## Warning in check_nas(estimate): Con la agregacion proporcionada algunas observaciones tienen cero
##     grados de libertad, por lo que no se puede estimar la varianza, dando como
##     resultado algunos elementos no finitos.</code></pre>
<pre><code>## # A tibble: 24 x 7
##    comuna_etiqueta sexo_etiqueta comuna_codigo sexo_codigo media_ytotcorh
##    &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt;                &lt;dbl&gt;
##  1 Valdivia        Mujer         14101         2                 1262564.
##  2 Valdivia        Hombre        14101         1                 1347409.
##  3 Corral          Hombre        14102         1                  713509.
##  4 Corral          Mujer         14102         2                  609975.
##  5 Lanco           Mujer         14103         2                  691757.
##  6 Lanco           Hombre        14103         1                  670080.
##  7 Los Lagos       Hombre        14104         1                  718525.
##  8 Los Lagos       Mujer         14104         2                  730578.
##  9 Máfil           Mujer         14105         2                  781906.
## 10 Máfil           Hombre        14105         1                  895474.
## # … with 14 more rows, and 2 more variables: media_ytotcorh_inf &lt;dbl&gt;,
## #   media_ytotcorh_sup &lt;dbl&gt;</code></pre>
<p>El uso de <code>mediana_agrupada()</code> es exactamente igual al punto anterior.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># Mediana salarial por comuna</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">mediana_agrupada</span>(r14, <span class="st">&quot;ytotcorh&quot;</span>, <span class="st">&quot;comuna&quot;</span>, <span class="st">&quot;expc&quot;</span>)</a></code></pre></div>
<pre><code>## Warning in check_nas(estimate): Con la agregacion proporcionada algunas observaciones tienen cero
##     grados de libertad, por lo que no se puede estimar la varianza, dando como
##     resultado algunos elementos no finitos.</code></pre>
<pre><code>## # A tibble: 12 x 5
##    comuna_etiqueta comuna_codigo mediana_ytotcorh mediana_ytotcor…
##    &lt;chr&gt;           &lt;chr&gt;                    &lt;dbl&gt;            &lt;dbl&gt;
##  1 Valdivia        14101                  906922.          801471 
##  2 Corral          14102                  577812           140000 
##  3 Lanco           14103                  637417           402782 
##  4 Los Lagos       14104                  622110           582273 
##  5 Máfil           14105                  717728              NaN 
##  6 Mariquina       14106                  661023.          430000 
##  7 Paillaco        14107                  539081.          435465 
##  8 Panguipulli     14108                  546453           532307.
##  9 La Unión        14201                  598123           550000 
## 10 Futrono         14202                  625866           118291 
## 11 Lago Ranco      14203                  678920.             NaN 
## 12 Río Bueno       14204                  665991           558775.
## # … with 1 more variable: mediana_ytotcorh_sup &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># Mediana salarial por comuna y sexo</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">mediana_agrupada</span>(r14, <span class="st">&quot;ytotcorh&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;comuna&quot;</span>,<span class="st">&quot;sexo&quot;</span>), <span class="st">&quot;expc&quot;</span>)</a></code></pre></div>
<pre><code>## Warning in check_nas(estimate): Con la agregacion proporcionada algunas observaciones tienen cero
##     grados de libertad, por lo que no se puede estimar la varianza, dando como
##     resultado algunos elementos no finitos.</code></pre>
<pre><code>## # A tibble: 24 x 7
##    comuna_etiqueta sexo_etiqueta comuna_codigo sexo_codigo mediana_ytotcorh
##    &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt;                  &lt;dbl&gt;
##  1 Valdivia        Mujer         14101         2                    900000 
##  2 Valdivia        Hombre        14101         1                    914376.
##  3 Corral          Hombre        14102         1                    596229 
##  4 Corral          Mujer         14102         2                    548684 
##  5 Lanco           Mujer         14103         2                    625511 
##  6 Lanco           Hombre        14103         1                    638530.
##  7 Los Lagos       Hombre        14104         1                    612354.
##  8 Los Lagos       Mujer         14104         2                    635936 
##  9 Máfil           Mujer         14105         2                    666300 
## 10 Máfil           Hombre        14105         1                    754550 
## # … with 14 more rows, and 2 more variables: mediana_ytotcorh_inf &lt;dbl&gt;,
## #   mediana_ytotcorh_sup &lt;dbl&gt;</code></pre>
</div>
<div id="medidas-de-tendencia-central-y-grados-de-libertad" class="section level1">
<h1>Medidas de tendencia central y grados de libertad</h1>
<p>El valor agregado del paquete CASEN es que entrega una forma fácil de hacer cálculos tomando en cuenta, además del diseño complejo, los grados de libertad.</p>
<p>Los grados de libertad son los valores de un conjunto de datos que tienen la posibilidad de variar después de haber impuesto alguna restricción sobre los mismos.</p>
<p>Veamos la siguiente expresión: <span class="math display">\[x + y  = 4\]</span></p>
<p>Hay infinitos valores de <span class="math inline">\(x\)</span> e <span class="math inline">\(y\)</span> que satisfacen la ecuación, pero solo tenemos la libertad de elegir el valor de una de las dos variables, ya que al hacerlo, inmediatamente queda fijada la otra.</p>
<p>Si agregamos una segunda ecuación, ya no queda ninguna variable en el sistema que podamos mover a nuestro antojo. Por ejemplo: <span class="math display">\[x + y  = 4\\x - y = 1\]</span></p>
<p>Pensando en el caso de la media y la desviación estándar: <span class="math display">\[\mu = \frac{1}{n}\sum_{i=1}^nx_i \quad \sigma = \frac{\sum_{i=1}^n(x_i-\bar{x})^2}{n - 1}\]</span></p>
<p>Si <span class="math inline">\(n\)</span> es muy grande, la pérdida de grados de libertad se torna irrelevante.</p>
<p>En el contexto de muestreo bietápico, el cálculo de los grados de libertad es un tema no resuelto, pero el paquete casen utiliza la siguiente fórmula que es la misma empleada por el INE: <span class="math display">\[GD = ConglomeradosInfo − EstratosInfo\]</span></p>
<p>En dominios de estimación pequeños la pérdida de grados de libertad se vuelve bastante relevante. Esto es muy importante cuando se hacen cálculos agrupando por región, sexo, región y sexo, entre otras.</p>
<p>Al usar la función <code>svyby</code> del paquete survey, la función no calcula correctamente los grados de libertad de cada dominio, sino que considera un valor fijo para todos los dominios. Las funciones del paquete casen usan esta función pero incluyen una serie de pasos complejos de programar para usar los grados de libertad adecuados para cada dominio de estimación.</p>
</div>
<div id="uso-de-las-funciones-de-casen-y-dplyr" class="section level1">
<h1>Uso de las funciones de casen y dplyr</h1>
<p>Las funciones de <code>casen</code> están pensadas para usarse en conjunto con las de <code>dplyr</code>. Un ejemplo simple de esto es el cálculo del porcentaje de hogares pobres.</p>
<p>Veamos el caso puntual de las funciones <code>mutate</code> y <code>filter</code> de dplyr:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># con mutate puedo convertir pobreza a una variable binaria</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">r14 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pobreza =</span> <span class="kw">ifelse</span>(pobreza <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="st">  </span><span class="kw">media_agrupada</span>(<span class="st">&quot;pobreza&quot;</span>, <span class="st">&quot;comuna&quot;</span>, <span class="st">&quot;expc&quot;</span>)</a></code></pre></div>
<pre><code>## Warning in check_nas(estimate): Con la agregacion proporcionada algunas observaciones tienen cero
##     grados de libertad, por lo que no se puede estimar la varianza, dando como
##     resultado algunos elementos no finitos.</code></pre>
<pre><code>## # A tibble: 12 x 5
##    comuna_etiqueta comuna_codigo media_pobreza media_pobreza_i…
##    &lt;chr&gt;           &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;
##  1 Valdivia        14101                0.0753          0.0513 
##  2 Corral          14102                0.259           0.0885 
##  3 Lanco           14103                0.195           0.0744 
##  4 Los Lagos       14104                0.156           0.101  
##  5 Máfil           14105                0.102         NaN      
##  6 Mariquina       14106                0.154          -0.00159
##  7 Paillaco        14107                0.209          -0.0754 
##  8 Panguipulli     14108                0.133           0.0928 
##  9 La Unión        14201                0.132           0.0660 
## 10 Futrono         14202                0.117          -0.295  
## 11 Lago Ranco      14203                0.103         NaN      
## 12 Río Bueno       14204                0.170           0.0743 
## # … with 1 more variable: media_pobreza_sup &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co"># con filter puedo dejar las observaciones de la 10ma region u otra</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="kw">leer_casen</span>(<span class="st">&quot;2017_spss.rar&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(region <span class="op">==</span><span class="st"> </span><span class="dv">10</span>)</a></code></pre></div>
</div>
<div id="inferencia-con-diseños-complejos" class="section level1">
<h1>Inferencia con diseños complejos</h1>
<p>El paquete casen provee dos funciones para sacar el máximo partido a las funciones de R tomando en cuenta el diseño complejo y los grados de libertad.</p>
<p>Por ejemplo, si queremos estimar el modelo: <span class="math display">\[ytotcorh = \beta_0 + \beta_1 comuna + \beta_2 sexo + \varepsilon\]</span></p>
<p>Los betas del modelo se pueden obtener de dos formas:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">modelo_lineal_generalizado</span>(r14, <span class="st">&quot;ytotcorh&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;comuna&quot;</span>, <span class="st">&quot;sexo&quot;</span>), <span class="st">&quot;expc&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 13 x 7
##    term            estimate std_error statistic  p_value conf_low conf_high
##    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1 (Intercept)     1331959.   128517.     10.4  1.53e-14 1075438.  1588481.
##  2 comunaCorral    -642591.   137144.     -4.69 1.88e- 5 -916333.  -368850.
##  3 comunaLanco     -621449.   132259.     -4.70 1.79e- 5 -885439.  -357460.
##  4 comunaLos Lagos -579666.   125585.     -4.62 2.39e- 5 -830335.  -328998.
##  5 comunaMáfil     -465695.   134021.     -3.47 1.00e- 3 -733203.  -198188.
##  6 comunaMariquina -532944.   163291.     -3.26 1.89e- 3 -858874.  -207013.
##  7 comunaPaillaco  -605114.   135751.     -4.46 4.12e- 5 -876074.  -334154.
##  8 comunaPanguipu… -645983.   125267.     -5.16 3.53e- 6 -896017.  -395949.
##  9 comunaLa Unión  -525886.   128681.     -4.09 1.43e- 4 -782734.  -269038.
## 10 comunaFutrono   -532511.   136537.     -3.90 2.64e- 4 -805040.  -259982.
## 11 comunaLago Ran… -584849.   130485.     -4.48 3.79e- 5 -845299.  -324399.
## 12 comunaRío Bueno -560813.   130805.     -4.29 7.35e- 5 -821901.  -299726.
## 13 sexoMujer        -55931.    20067.     -2.79 7.28e- 3  -95984.   -15878.</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">modelo_lineal_generalizado_2</span>(r14, <span class="st">&quot;ytotcorh ~ comuna + sexo&quot;</span>, <span class="st">&quot;expc&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 13 x 7
##    term            estimate std_error statistic  p_value conf_low conf_high
##    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1 (Intercept)     1331959.   128517.     10.4  1.53e-14 1075438.  1588481.
##  2 comunaCorral    -642591.   137144.     -4.69 1.88e- 5 -916333.  -368850.
##  3 comunaLanco     -621449.   132259.     -4.70 1.79e- 5 -885439.  -357460.
##  4 comunaLos Lagos -579666.   125585.     -4.62 2.39e- 5 -830335.  -328998.
##  5 comunaMáfil     -465695.   134021.     -3.47 1.00e- 3 -733203.  -198188.
##  6 comunaMariquina -532944.   163291.     -3.26 1.89e- 3 -858874.  -207013.
##  7 comunaPaillaco  -605114.   135751.     -4.46 4.12e- 5 -876074.  -334154.
##  8 comunaPanguipu… -645983.   125267.     -5.16 3.53e- 6 -896017.  -395949.
##  9 comunaLa Unión  -525886.   128681.     -4.09 1.43e- 4 -782734.  -269038.
## 10 comunaFutrono   -532511.   136537.     -3.90 2.64e- 4 -805040.  -259982.
## 11 comunaLago Ran… -584849.   130485.     -4.48 3.79e- 5 -845299.  -324399.
## 12 comunaRío Bueno -560813.   130805.     -4.29 7.35e- 5 -821901.  -299726.
## 13 sexoMujer        -55931.    20067.     -2.79 7.28e- 3  -95984.   -15878.</code></pre>
<p>La última función permite escribir modelos más complejos con componentes logarítmicas o cuadráticas. Por ejemplo, el modelo que relaciona ingresos con el tipo de institución de educación superior y edad (h3 y e8 en cuestionario CASEN 2017) podría ser <span class="math display">\[ytotcorh = \beta_0 + \beta_1 inst + \beta_2 edad + \beta_3 edad^2 + \varepsilon\]</span> Usando la notación de R el modelo se escribe:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">ytotcorh <span class="op">~</span><span class="st"> </span><span class="kw">factor</span>(e8) <span class="op">+</span><span class="st"> </span>h3 <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(h3<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<p>Si quisiera el modelo sin constante, hay dos posibilidades:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">ytotcorh <span class="op">~</span><span class="st"> </span><span class="kw">factor</span>(e8) <span class="op">+</span><span class="st"> </span>h3 <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(h3<span class="op">^</span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2">ytotcorh <span class="op">~</span><span class="st"> </span><span class="kw">factor</span>(e8) <span class="op">+</span><span class="st"> </span>h3 <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(h3<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">0</span></a></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
